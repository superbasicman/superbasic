# SuperBasic Finance

An API-first personal finance platform built as a monorepo. The web client is a thin React SPA that consumes a typed JSON API. Developers can provision API keys to build their own tools.

## Core Principles

- **API-first**: Stable /v1 JSON endpoints backed by Zod schemas with autogenerated OpenAPI 3.1 contract
- **Secure by design**: Auth.js + hashed PATs, least-privilege Prisma access, Upstash rate limits, auditable changes
- **Thin client**: React SPA calls public API exclusively; no direct DB access or secrets in web app
- **Portable**: Pure client-side architecture enables easy wrapping with Capacitor for mobile deployment
- **Operationally simple**: Vercel deploys, serverless-friendly jobs, reproducible migrations

## Project Structure

```
.
├── apps/
│   ├── api/                  # Hono API server exposing /v1 routes
│   └── web/                  # Thin React SPA (Vite)
├── packages/
│   ├── auth/                 # Auth.js adapters, PAT hashing, RBAC scopes
│   ├── core/                 # Domain logic (billing, ledgers, limits)
│   ├── database/             # Prisma schema + migrations + client exports
│   ├── design-system/        # Custom React components with Tailwind CSS
│   ├── observability/        # Logging, tracing, audit emitters
│   ├── rate-limit/           # Upstash helpers
│   ├── sdk/                  # Generated OpenAPI client
│   └── types/                # Zod contracts shared across layers
└── tooling/                  # CI workflows and scripts (future)
```

## Technology Stack

### Backend
- **Hono 4** on Node adapter serving /v1 routes
- **Zod** for validation with OpenAPI generation
- **Prisma 6** with Neon-hosted Postgres
- **Auth.js** for authentication with JWT sessions
- **Upstash Redis** for rate limiting and caching
- **Vitest** for unit/integration tests

### Frontend
- **Vite** + **React 19** (pure SPA, no SSR)
- **React Router** for client-side routing
- **Tailwind CSS** for styling
- **TanStack Query** for API state management
- **Playwright** for E2E testing

### Monorepo Tooling
- **pnpm** workspaces for package management
- **Turborepo** for build orchestration
- **Biome** for linting and formatting
- **tsup** for package bundling

## Getting Started

### Prerequisites

- Node.js 20+
- pnpm 9+
- PostgreSQL database (or Neon account)

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd superbasic-finance
```

2. Install dependencies:
```bash
pnpm install
```

3. Set up environment variables:
```bash
# Copy example files
cp .env.example .env
cp apps/api/.env.example apps/api/.env
cp apps/web/.env.example apps/web/.env
cp packages/database/.env.example packages/database/.env

# Edit .env files with your actual values
```

4. Generate Prisma client:
```bash
pnpm db:generate
```

5. Run database migrations:
```bash
pnpm db:migrate
```

6. Build all packages:
```bash
pnpm build
```

7. Start development servers:
```bash
pnpm dev
```

The API will be available at `http://localhost:3000` and the web client at `http://localhost:5173`.

## Common Commands

### Development

```bash
# Start all apps in development mode
pnpm dev

# Start specific app only
pnpm dev --filter=api
pnpm dev --filter=web
```

### Building

```bash
# Build all packages and apps
pnpm build

# Build specific package/app
pnpm build --filter=api
pnpm build --filter=@repo/core
```

### Testing

```bash
# Run all tests
pnpm test

# Run unit tests only
pnpm test:unit

# Run E2E tests with Playwright
pnpm test:e2e
```

### Code Quality

```bash
# Lint all packages
pnpm lint

# Type check all packages
pnpm typecheck

# Format code with Biome
pnpm format
```

### Database

```bash
# Generate Prisma client
pnpm db:generate

# Run migrations
pnpm db:migrate

# Open Prisma Studio
pnpm db:studio

# Reset database (dev only)
pnpm db:reset
```

### OpenAPI & SDK

```bash
# Generate OpenAPI spec (future)
pnpm api:docs

# Generate SDK from OpenAPI spec (future)
pnpm sdk:generate
```

## Workspace Packages

### @repo/database
Prisma schema, migrations, and client exports. All database access goes through this package.

### @repo/types
Shared Zod schemas for API contracts. Used by both API and web client for type safety.

### @repo/auth
Auth.js configuration, PAT utilities, and RBAC scope definitions.

### @repo/core
Domain logic including billing, ledgers, and limits. Pure functions that can be tested in isolation.

### @repo/sdk
Generated OpenAPI client for consuming the API. Will be auto-generated from the OpenAPI spec.

### @repo/observability
Logging and tracing utilities using Pino and Sentry.

### @repo/rate-limit
Upstash Redis helpers for rate limiting API endpoints.

### @repo/design-system
Custom React components built with Tailwind CSS. No third-party UI libraries.

## Development Workflow

1. Create a feature branch from `main`
2. Make your changes in the appropriate package or app
3. Run `pnpm lint` and `pnpm typecheck` to verify code quality
4. Run `pnpm test` to ensure tests pass
5. Run `pnpm build` to verify everything compiles
6. Commit your changes and open a pull request

## Architecture Decisions

### API-First Design
All data access happens through the public API. The web client never directly accesses the database or contains sensitive secrets. This enables:
- Easy mobile app development with Capacitor
- Third-party integrations via API keys
- Clear separation of concerns

### Thin Client
The React SPA is purely client-side with no server-side rendering. All business logic lives in the API or shared packages. This keeps the client simple and portable.

### Append-Only Ledger
Financial data is never deleted or mutated. All changes are recorded as new ledger entries, providing a complete audit trail.

### Workspace Multi-Tenancy
All data is scoped to workspaces with row-level security policies. Users can belong to multiple workspaces with different roles.

## Security

- All API endpoints require Bearer authentication (JWT or PAT)
- Personal access tokens are hashed before storage
- Rate limiting on all public endpoints via Upstash Redis
- Row-level security policies in Postgres (planned)
- Stripe webhook signatures verified with HMAC
- Audit trail for all sensitive operations

## Deployment

- **API**: Deployed to Vercel with Node.js runtime
- **Web**: Deployed to Vercel as static SPA
- **Database**: Neon Postgres with instant branching for preview environments
- **Redis**: Upstash for rate limiting and caching
- **Jobs**: Upstash QStash for background processing

Environments: `dev`, `preview`, `prod` with isolated databases.

## Contributing

1. Follow the code style enforced by Biome
2. Write tests for new features
3. Update documentation as needed
4. Keep PRs focused and reasonably sized
5. Reference requirements in commit messages

## License

[Add your license here]

## Support

[Add support information here]
