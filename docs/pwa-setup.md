# PWA Setup Guide

SuperBasic Finance is configured as a Progressive Web App (PWA) with offline support and installability.

## Current Status

✅ **PWA Infrastructure Complete**
- vite-plugin-pwa installed and configured
- Service worker auto-registration enabled
- Workbox precaching configured
- Placeholder icons generated
- Manifest file auto-generated

## Architecture

### Service Worker

The service worker is automatically generated by `vite-plugin-pwa` during build:

- **Mode**: `generateSW` (Workbox generates the service worker)
- **Registration**: `autoUpdate` (updates apply automatically)
- **Precaching**: All static assets (JS, CSS, HTML, icons)
- **Runtime Caching**: API requests cached with NetworkFirst strategy (5 min TTL)

### Manifest

Generated from `apps/web/vite.config.ts`:

```typescript
{
  name: 'SuperBasic Finance',
  short_name: 'SuperBasic',
  description: 'API-first personal finance platform',
  theme_color: '#ffffff',
  background_color: '#ffffff',
  display: 'standalone',
  start_url: '/',
  icons: [/* 192x192, 512x512, maskable */]
}
```

### Icons

Current icons are **placeholders** located in `apps/web/public/`:

- `pwa-192x192.png` - PWA icon (192x192)
- `pwa-512x512.png` - PWA icon (512x512)
- `apple-touch-icon.png` - iOS home screen icon (180x180)
- `favicon.svg` - SVG favicon with "SBF" text
- `favicon.png` - PNG favicon fallback (32x32)
- `favicon.ico` - ICO favicon fallback

## Verification

### Build Verification

```bash
# Build the app
pnpm build --filter=web

# Check for PWA files in output
ls -la apps/web/dist/*.png apps/web/dist/sw.js apps/web/dist/manifest.webmanifest
```

Expected output:
```
PWA v1.1.0
mode      generateSW
precache  15 entries (343.08 KiB)
files generated
  dist/sw.js
  dist/workbox-6bc9069b.js
```

### Runtime Verification

```bash
# Start preview server
pnpm preview --filter=web

# Open http://localhost:4173
```

Then check in DevTools:

1. **Application → Manifest**
   - Verify manifest loads
   - Check icon URLs resolve
   - Confirm installability

2. **Application → Service Workers**
   - Verify service worker is active
   - Check for update on reload
   - Test offline mode

3. **Network → Offline**
   - Enable offline mode
   - Reload page
   - Verify app loads from cache

### Automated Verification

```bash
# Run verification script
./tooling/scripts/verify-pwa.sh
```

## Replacing Placeholder Icons

To use real branded icons:

1. **Design icons** at required sizes (or use single high-res source)
2. **Export as PNG** with exact filenames
3. **Replace files** in `apps/web/public/`
4. **Rebuild**: `pnpm build --filter=web`

### Recommended Tools

- [Figma](https://figma.com) - Design icons
- [RealFaviconGenerator](https://realfavicongenerator.net/) - Generate all sizes
- [PWA Asset Generator](https://github.com/elegantapp/pwa-asset-generator) - CLI tool

### Icon Requirements

- **PWA icons**: Square, no transparency, solid background
- **Apple touch icon**: Square (iOS applies rounded corners)
- **Favicon**: Simple, recognizable at small sizes

## Configuration

### Vite Config (`apps/web/vite.config.ts`)

```typescript
VitePWA({
  registerType: 'autoUpdate',
  includeAssets: ['favicon.ico', 'apple-touch-icon.png', 'mask-icon.svg'],
  manifest: {
    name: 'SuperBasic Finance',
    short_name: 'SuperBasic',
    // ... manifest config
  },
  workbox: {
    globPatterns: ['**/*.{js,css,html,ico,png,svg}'],
    runtimeCaching: [
      {
        urlPattern: /^https:\/\/api\./,
        handler: 'NetworkFirst',
        options: {
          cacheName: 'api-cache',
          expiration: {
            maxEntries: 50,
            maxAgeSeconds: 60 * 5, // 5 minutes
          },
        },
      },
    ],
  },
})
```

### HTML Meta Tags (`apps/web/index.html`)

```html
<!-- PWA Meta Tags -->
<meta name="description" content="API-first personal finance platform" />
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)" />

<!-- Apple Touch Icon -->
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

<!-- iOS Status Bar -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
```

## Deployment

### Vercel

PWA works automatically on Vercel:

1. Service worker served with correct headers
2. Manifest served with `application/manifest+json`
3. Icons served from `/public` directory
4. HTTPS required for service worker registration

### Testing on Mobile

1. **Deploy to Vercel** (or use ngrok for local testing)
2. **Open in mobile browser** (Safari on iOS, Chrome on Android)
3. **Check for install prompt** (may appear automatically or in browser menu)
4. **Install to home screen**
5. **Test offline mode** by enabling airplane mode

## Troubleshooting

### Service Worker Not Registering

- Check browser console for errors
- Verify HTTPS (required for service workers)
- Check `registerSW.js` is loaded in Network tab
- Clear browser cache and hard reload

### Icons Not Loading

- Verify files exist in `apps/web/public/`
- Check Network tab for 404 errors
- Rebuild app: `pnpm build --filter=web`
- Check manifest URLs match actual file paths

### App Not Installable

- Verify manifest is valid (DevTools → Application → Manifest)
- Check all required manifest fields are present
- Ensure icons are correct sizes (192x192, 512x512)
- Verify HTTPS (required for installability)

### Offline Mode Not Working

- Check service worker is active (DevTools → Application → Service Workers)
- Verify precache includes all required assets
- Check Workbox configuration in `vite.config.ts`
- Test with Network → Offline in DevTools

## Future Enhancements

- [ ] Add push notification support
- [ ] Implement background sync for offline transactions
- [ ] Add app shortcuts to manifest
- [ ] Create iOS splash screens
- [ ] Add share target for importing files
- [ ] Implement periodic background sync

## References

- [vite-plugin-pwa Documentation](https://vite-pwa-org.netlify.app/)
- [Workbox Documentation](https://developer.chrome.com/docs/workbox/)
- [Web App Manifest Spec](https://www.w3.org/TR/appmanifest/)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
