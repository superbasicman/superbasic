# Auth.js Session Payload Reference

## Purpose
- Provide a stable example of the JSON returned by `GET /v1/auth/session`
- Give middleware owners a single source of truth while the Auth.js migration continues
- Document the invariants that downstream services should rely upon (and what remains private to Auth.js)

## Golden Response
Captured from a passing run of `pnpm test authjs-credentials --filter=@repo/api` after signing in a seeded user through the Credentials provider.

```json
{
  "user": {
    "id": "user_5f1cbd4d-44e5-4a65-9bb4-6b0dd7f25f3e",
    "email": "test.user@example.com",
    "name": "Test User",
    "image": null
  },
  "expires": "2025-02-20T14:12:04.123Z"
}
```

> **Note:** `expires` is an ISO 8601 string generated by Auth.js. The exact value varies per request; the one above reflects the default 30-day session window configured in `packages/auth/src/config.ts`.

## Field Notes
- `user.id` &mdash; Primary key from `users.id` (UUID). This is the identifier that downstream middleware must continue to accept.
- `user.email` &mdash; Lowercase email stored in the database. Auth.js normalises casing before building the session.
- `user.name` &mdash; Optional display name. `null` when not provided by the profile.
- `user.image` &mdash; Always `null` for Credentials sign-ins today. OAuth tasks may start populating this.
- `expires` &mdash; Session expiry timestamp. Used primarily by Auth.js when refreshing sessions; middleware should treat it as informational.

## Cookie Linkage
- Session cookie name (development): `authjs.session-token`
- Production cookie (`AUTH_URL` served over HTTPS): prefixed with `__Secure-`
- Cookie is HttpOnly, `SameSite=Lax`, `Path=/`, and carries an `Expires` attribute that matches the timestamp above.

## Middleware Expectations
- Continue reading the session via `request.headers.get('Cookie')` → `authjs.session-token` → Auth.js session parser.
- Downstream code must not assume presence of `user.image` or other optional claims; only `id`, `email`, and `name` are guaranteed today.
- Token revocation remains best-effort (stateless JWT). Clearing the cookie is the authoritative sign-out mechanism.

## Reproducing Locally
1. `pnpm dev --filter=@repo/api`
2. `curl -i http://localhost:3000/v1/auth/csrf` → capture `csrfToken` + cookie
3. POST form-encoded credentials to `/v1/auth/callback/credentials` with the CSRF artefacts
4. Use the returned `authjs.session-token` cookie to call `/v1/auth/session`
5. Response should match the shape documented above

For automated usage, prefer the helpers in `apps/api/src/test/helpers.ts` (`postAuthJsForm` and `signInWithCredentials`) which encapsulate the CSRF flow.

## Related Documents
- `docs/authjs-task-4-findings.md` &mdash; CSRF and session compatibility deep-dive
- `docs/authjs-helper-extension.md` &mdash; Test helper updates that generated this capture
